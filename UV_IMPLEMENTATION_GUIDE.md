# üöÄ Gu√≠a Completa: Aplicaci√≥n de UV en terraform-var-manager

## üìã Tabla de Contenidos

1. [¬øQu√© es UV?](#qu√©-es-uv)
2. [¬øPor qu√© UV en lugar de pip/poetry?](#por-qu√©-uv-en-lugar-de-pippoetry)
3. [Instalaci√≥n de UV](#instalaci√≥n-de-uv)
4. [Migraci√≥n del Script Original](#migraci√≥n-del-script-original)
5. [Estructura del Proyecto con UV](#estructura-del-proyecto-con-uv)
6. [Configuraci√≥n Detallada](#configuraci√≥n-detallada)
7. [Gesti√≥n de Dependencias](#gesti√≥n-de-dependencias)
8. [Flujo de Desarrollo](#flujo-de-desarrollo)
9. [Build y Distribuci√≥n](#build-y-distribuci√≥n)
10. [Comandos UV Utilizados](#comandos-uv-utilizados)
11. [Mejores Pr√°cticas](#mejores-pr√°cticas)
12. [Troubleshooting](#troubleshooting)

---

## üéØ ¬øQu√© es UV?

**UV** es un gestor de paquetes y proyectos Python de nueva generaci√≥n desarrollado por **Astral** (creadores de Ruff). Est√° escrito en **Rust** y es extremadamente r√°pido.

### Caracter√≠sticas Principales:
- ‚ö° **10-100x m√°s r√°pido** que pip
- üîí **Lock files autom√°ticos** para reproducibilidad
- üêç **Gesti√≥n de versiones Python** integrada
- üì¶ **Gesti√≥n completa de proyectos** (creaci√≥n, build, publish)
- üõ†Ô∏è **Reemplaza m√∫ltiples herramientas**: pip, virtualenv, poetry, pipenv, pyenv

---

## ü§î ¬øPor qu√© UV en lugar de pip/poetry?

### Comparaci√≥n con Herramientas Tradicionales:

| Caracter√≠stica | UV | Poetry | pip + venv | pipenv |
|----------------|----|---------|-----------| -------|
| **Velocidad** | ‚ö° Muy r√°pida | üêå Lenta | üêå Lenta | üêå Lenta |
| **Lock files** | ‚úÖ Autom√°tico | ‚úÖ Manual | ‚ùå No | ‚úÖ Manual |
| **Gesti√≥n Python** | ‚úÖ Integrada | ‚ùå No | ‚ùå No | ‚ùå No |
| **Build/Publish** | ‚úÖ Nativo | ‚úÖ S√≠ | ‚ùå No | ‚ùå No |
| **Configuraci√≥n** | üìÑ Simple | üìÑ Compleja | üìÑ Manual | üìÑ Media |


## üîß Instalaci√≥n de UV

### Instalaci√≥n Realizada:
```bash
# Instalaci√≥n usando el script oficial
curl -LsSf https://astral.sh/uv/install.sh | sh

# Verificaci√≥n
uv --version
# Output: uv 0.8.13
```

### Configuraci√≥n de PATH:
```bash
# Agregar al PATH (autom√°tico en la instalaci√≥n)
export PATH="$HOME/.local/bin:$PATH"
```

### Alternativas de Instalaci√≥n:
```bash
# Via pip (si ya tienes Python)
pip install uv

# Via homebrew (macOS)
brew install uv

# Via cargo (si tienes Rust)
cargo install --git https://github.com/astral-sh/uv uv
```

---

## üì¶ Migraci√≥n del Script Original

### Estado Original:
```
terraform-var-manager/
‚îú‚îÄ‚îÄ script_variables.py    # Script monol√≠tico
‚îî‚îÄ‚îÄ README.md
```

### Proceso de Migraci√≥n:

#### 1. Inicializaci√≥n del Proyecto UV:
```bash
# Crear estructura de proyecto con UV
uv init --lib terraform-var-manager

# Esto genera:
terraform-var-manager/
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ src/terraform_var_manager/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ py.typed
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .python-version
```

#### 2. Refactorizaci√≥n del C√≥digo:
```bash
# Mover y modularizar el script original
mv script_variables.py terraform-var-manager/src/terraform_var_manager/main.py

# Crear m√≥dulos separados:
# - api_client.py: Cliente para Terraform Cloud API
# - variable_manager.py: L√≥gica de negocio de alto nivel
# - utils.py: Funciones utilitarias
# - main.py: CLI interface
```

#### 3. Estructura Modular Resultante:
```
src/terraform_var_manager/
‚îú‚îÄ‚îÄ __init__.py           # Package principal con exports
‚îú‚îÄ‚îÄ main.py              # CLI interface (ArgumentParser)
‚îú‚îÄ‚îÄ api_client.py        # TerraformCloudClient class
‚îú‚îÄ‚îÄ variable_manager.py  # VariableManager class
‚îú‚îÄ‚îÄ utils.py             # Funciones utilitarias
‚îî‚îÄ‚îÄ py.typed             # Typing marker
```

---

## üèóÔ∏è Estructura del Proyecto con UV

### Estructura Final:
```
terraform-var-manager/
‚îú‚îÄ‚îÄ .gitignore                    # Configuraci√≥n Git
‚îî‚îÄ‚îÄ terraform-var-manager/       # Package principal
    ‚îú‚îÄ‚îÄ src/terraform_var_manager/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ main.py
    ‚îÇ   ‚îú‚îÄ‚îÄ api_client.py
    ‚îÇ   ‚îú‚îÄ‚îÄ variable_manager.py
    ‚îÇ   ‚îî‚îÄ‚îÄ utils.py
    ‚îú‚îÄ‚îÄ tests/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îî‚îÄ‚îÄ test_utils.py
    ‚îú‚îÄ‚îÄ .venv/                    # Entorno virtual UV
    ‚îú‚îÄ‚îÄ .pytest_cache/
    ‚îú‚îÄ‚îÄ dist/                     # Distribuciones built
    ‚îú‚îÄ‚îÄ pyproject.toml            # Configuraci√≥n principal
    ‚îú‚îÄ‚îÄ README.md                 # Documentaci√≥n
    ‚îú‚îÄ‚îÄ LICENSE                   # Licencia MIT
    ‚îú‚îÄ‚îÄ dev.sh                    # Script de desarrollo
    ‚îî‚îÄ‚îÄ uv.lock                   # Lock file
```

## ‚öôÔ∏è Configuraci√≥n Detallada

### pyproject.toml Configurado:

```toml
[project]
name = "terraform-var-manager"
version = "0.1.0"
description = "A tool to manage Terraform Cloud variables..."
readme = "README.md"
authors = [
    { name = "Geordy Kindley", email = "gekindley@gmail.com" }
]
requires-python = ">=3.9"
dependencies = [
    "requests>=2.28.0",
]
keywords = ["terraform", "terraform-cloud", "variables", "devops"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3.9",
    # ... m√°s classifiers
]

[project.urls]
Homepage = "https://github.com/gekindley/terraform-var-manager"
Repository = "https://github.com/gekindley/terraform-var-manager"

[project.scripts]
terraform-var-manager = "terraform_var_manager.main:main"
tfvar-manager = "terraform_var_manager.main:main"

[build-system]
requires = ["uv_build>=0.8.13,<0.9.0"]
build-backend = "uv_build"

[tool.pytest.ini_options]
minversion = "6.0"
addopts = "-ra -q --strict-markers"
testpaths = ["tests"]

[dependency-groups]
dev = [
    "pytest>=8.4.1",
    "pytest-cov>=6.2.1",
]
```

### Explicaci√≥n de Secciones:

#### `[project]`:
- **name**: Nombre en PyPI (con guiones)
- **scripts**: Entry points para CLI
- **dependencies**: Dependencias de producci√≥n
- **classifiers**: Metadatos para PyPI

#### `[build-system]`:
- **requires**: Backend de build (uv_build)
- **build-backend**: Motor de construcci√≥n

#### `[dependency-groups]`:
- **dev**: Dependencias de desarrollo
- Reemplaza `[tool.poetry.group.dev.dependencies]`

---

## üìö Gesti√≥n de Dependencias

### Dependencias de Producci√≥n:
```bash
# Agregar dependencia de producci√≥n
uv add requests

# Especificar versi√≥n
uv add "requests>=2.28.0"

# Agregar m√∫ltiples
uv add requests click typer
```

### Dependencias de Desarrollo:
```bash
# Agregar dependencias de desarrollo
uv add --dev pytest pytest-cov

# Instalar todas las dependencias (prod + dev)
uv sync --all-extras
```

### Lock File (uv.lock):
```yaml
# Archivo generado autom√°ticamente
# Garantiza builds reproducibles
# Similar a poetry.lock o Pipfile.lock

version = 1
requires-python = ">=3.9"

[[package]]
name = "requests"
version = "2.32.5"
source = { registry = "https://pypi.org/simple" }
# ... m√°s detalles
```

### Comandos de Gesti√≥n:
```bash
# Instalar dependencias del proyecto
uv sync

# Actualizar dependencias
uv sync --upgrade

# Instalar en entorno espec√≠fico
uv sync --python 3.11

# Solo dependencias de producci√≥n
uv sync --no-dev
```

---

## üîÑ Flujo de Desarrollo

### Script de Desarrollo (dev.sh):
```bash
#!/bin/bash
# Script personalizado para tareas comunes

case "${1:-help}" in
    install)
        uv sync --all-extras
        ;;
    test)
        uv run pytest tests/ -v --cov=src/terraform_var_manager
        ;;
    build)
        uv build
        ;;
    run)
        shift
        uv run terraform-var-manager "$@"
        ;;
esac
```

### Flujo T√≠pico de Desarrollo:
```bash
# 1. Instalar dependencias
./dev.sh install

# 2. Ejecutar tests
./dev.sh test

# 3. Ejecutar CLI en desarrollo
./dev.sh run --help

# 4. Build para distribuci√≥n
./dev.sh build

# 5. Limpiar artifacts
./dev.sh clean
```

### Comandos UV Directos:
```bash
# Ejecutar script dentro del entorno
uv run python -c "from terraform_var_manager import VariableManager; print('OK')"

# Ejecutar comando CLI
uv run terraform-var-manager --help

# Ejecutar tests
uv run pytest

# Activar shell del entorno virtual
uv shell
```

---

## üì¶ Build y Distribuci√≥n

### Proceso de Build:
```bash
# Build autom√°tico con UV
uv build

# Genera:
dist/
‚îú‚îÄ‚îÄ terraform_var_manager-0.1.0.tar.gz      # Source distribution
‚îî‚îÄ‚îÄ terraform_var_manager-0.1.0-py3-none-any.whl  # Wheel
```

### Verificaci√≥n de Build:
```bash
# Instalar desde wheel local
uv pip install dist/terraform_var_manager-0.1.0-py3-none-any.whl

# Probar instalaci√≥n
terraform-var-manager --help
```

### Publicaci√≥n (cuando est√© listo):
```bash
# Configurar credenciales PyPI
uv config --set pypi.token <token>

# Publicar en TestPyPI primero
uv publish --repository testpypi

# Publicar en PyPI real
uv publish
```

---

## üõ†Ô∏è Comandos UV Utilizados

### Gesti√≥n de Proyecto:
```bash
uv init --lib terraform-var-manager     # Inicializar proyecto
uv add requests                          # Agregar dependencia
uv add --dev pytest                     # Agregar dep de desarrollo
uv sync                                 # Instalar dependencias
uv sync --all-extras                    # Instalar todas las deps
```

### Ejecuci√≥n:
```bash
uv run terraform-var-manager --help     # Ejecutar CLI
uv run pytest                          # Ejecutar tests
uv run python script.py                # Ejecutar Python
uv shell                               # Activar entorno
```

### Build y Distribuci√≥n:
```bash
uv build                               # Construir package
uv publish                             # Publicar en PyPI
uv publish --repository testpypi       # Publicar en TestPyPI
```

### Gesti√≥n de Python:
```bash
uv python install 3.11                 # Instalar Python 3.11
uv python list                         # Listar Pythons disponibles
uv sync --python 3.11                  # Usar Python espec√≠fico
```

---

## ‚úÖ Mejores Pr√°cticas

### 1. Estructura de Proyecto:
- ‚úÖ Usar `src/` layout para packages
- ‚úÖ Separar tests en directorio propio
- ‚úÖ Incluir `py.typed` para type hints
- ‚úÖ Usar entry points para CLI

### 2. Gesti√≥n de Dependencias:
- ‚úÖ Especificar versiones m√≠nimas (`>=`)
- ‚úÖ Usar dependency groups para organizar
- ‚úÖ Incluir `uv.lock` en control de versiones
- ‚úÖ Mantener `pyproject.toml` limpio

### 3. Development Workflow:
- ‚úÖ Crear script de desarrollo (`dev.sh`)
- ‚úÖ Usar `uv run` para comandos
- ‚úÖ Configurar tests automatizados
- ‚úÖ Build regular para validaci√≥n

### 4. Distribuci√≥n:
- ‚úÖ Probar en TestPyPI primero
- ‚úÖ Verificar metadatos en `pyproject.toml`
- ‚úÖ Incluir documentaci√≥n completa
- ‚úÖ Usar semantic versioning

---

## üö® Troubleshooting

### Problemas Comunes:

#### 1. Import Errors:
```bash
# Error: ModuleNotFoundError
# Soluci√≥n: Instalar en modo editable
uv pip install -e .
```

#### 2. Lock File Conflicts:
```bash
# Error: uv.lock conflictos
# Soluci√≥n: Regenerar lock
rm uv.lock
uv sync
```

#### 3. Python Version Issues:
```bash
# Error: Python version incompatible
# Soluci√≥n: Especificar Python
uv sync --python 3.9
```

#### 4. Build Failures:
```bash
# Error: Build falla
# Soluci√≥n: Verificar pyproject.toml
uv build --verbose
```

### Debugging:
```bash
# Verbose output
uv --verbose sync

# Ver configuraci√≥n
uv config list

# Ver entorno
uv run python -c "import sys; print(sys.path)"
```

---

## üéØ Conclusiones

### Beneficios Obtenidos:
1. **‚ö° Velocidad**: Gesti√≥n de dependencias extremadamente r√°pida
2. **üîí Reproducibilidad**: Lock files autom√°ticos
3. **üéõÔ∏è Simplicidad**: Una herramienta para todo el ciclo de vida
4. **üöÄ Modernidad**: Siguiendo las mejores pr√°cticas actuales
5. **üì¶ Profesionalismo**: Package listo para distribuci√≥n

### Lecciones Aprendidas:
- UV simplifica enormemente la gesti√≥n de proyectos Python
- La estructura modular mejora maintainability
- Los entry points hacen el CLI m√°s profesional
- El flujo de desarrollo es m√°s eficiente

### Recomendaciones Futuras:
- Usar UV para todos los proyectos Python nuevos
- Migrar proyectos existentes gradualmente
- Aprovechar la gesti√≥n de versiones Python integrada
- Explorar funcionalidades avanzadas como workspaces

---

## üîÑ Actualizaci√≥n y Rebuild del Package

### Cuando actualices el c√≥digo del package, sigue este flujo:

#### 1. **Despu√©s de realizar cambios en el c√≥digo:**
```bash
cd terraform-var-manager/

# Verificar que los cambios no rompan nada
./dev.sh test
```

#### 2. **Actualizar la versi√≥n (opcional pero recomendado):**
```bash
# Editar pyproject.toml y cambiar la versi√≥n
# version = "0.1.0" ‚Üí version = "0.1.1"
nano pyproject.toml
```

#### 3. **Rebuild del package:**
```bash
# Limpiar builds anteriores
./dev.sh clean

# Crear nuevo build
./dev.sh build

# O usando comandos UV directos:
uv build --clean
```

#### 4. **Verificar el nuevo build:**
```bash
# Verificar que se generaron los archivos
ls -la dist/

# Probar instalaci√≥n local del nuevo build
cd /tmp
uv venv test-install
source test-install/bin/activate
uv pip install /path/to/terraform-var-manager/dist/terraform_var_manager-0.1.1-py3-none-any.whl

# Probar que funciona
terraform-var-manager --help
```

#### 5. **Flujo completo automatizado:**
```bash
#!/bin/bash
# Script para actualizaci√≥n completa

# Ejecutar tests
echo "üß™ Ejecutando tests..."
./dev.sh test || exit 1

# Limpiar builds anteriores  
echo "üßπ Limpiando builds anteriores..."
./dev.sh clean

# Crear nuevo build
echo "üì¶ Creando nuevo build..."
./dev.sh build

# Verificar archivos generados
echo "‚úÖ Archivos generados:"
ls -la dist/

echo "üéâ ¬°Build completado exitosamente!"
```

#### 6. **Para publicaci√≥n (despu√©s del build):**
```bash
# Solo cuando est√©s listo para publicar
# Primero en TestPyPI
uv publish --repository testpypi

# Despu√©s en PyPI real
uv publish
```

### üìã **Checklist de Actualizaci√≥n:**

- [ ] ‚úÖ Tests pasan (`./dev.sh test`)
- [ ] üìù Versi√≥n actualizada en `pyproject.toml` (si aplica)
- [ ] üßπ Build anterior limpiado (`./dev.sh clean`)
- [ ] üì¶ Nuevo build creado (`./dev.sh build`)
- [ ] üîç Build verificado localmente
- [ ] üìö Documentaci√≥n actualizada (si aplica)
- [ ] üè∑Ô∏è Git tag creado para nueva versi√≥n (si aplica)
- [ ] üöÄ Publicado (cuando est√© listo)

### ‚ö° **Comando R√°pido para Desarrollo:**
```bash
# Un solo comando para rebuild r√°pido durante desarrollo
./dev.sh test && ./dev.sh clean && ./dev.sh build
```

---

**üéâ ¬°UV transform√≥ terraform-var-manager de un script simple a un package Python profesional y distribuible!**
